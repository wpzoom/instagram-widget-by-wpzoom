(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(e,i,n){return(i=function(e){var i=function(e){if("object"!=t(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,"string");if("object"!=t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(i)?i:i+""}(i))in e?Object.defineProperty(e,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[i]=n,e}var i;(i=jQuery)(window).on("load",(function(){var n=!1;function a(){i(".wpzinsta-pro-load-more-btn").off("click.loadmore").on("click.loadmore",(function(n){n.preventDefault();var a=i(this),o=a.closest(".wpzinsta-pro-load-more-wrapper"),r=a.closest(".zoom-instagram"),s=r.find(".zoom-instagram-widget__items");if("true"!==o.attr("data-disabled")&&!a.prop("disabled")&&!a.hasClass("loading")){var l=a.attr("data-feed-id"),d=a.attr("data-item-amount"),g=a.attr("data-image-size"),m=a.attr("data-allowed-post-types"),c=a.attr("data-next-url"),p=a.attr("data-nonce");if(c){a.addClass("loading").prop("disabled",!0),o.addClass("loading");var f=a.find(".button-text").text();a.find(".button-text").text("Loading..."),i.ajax({url:wpzInstaAjax.ajaxurl,type:"POST",dataType:"json",data:{action:"wpzoom_instagram_load_more",feed_id:l,item_amount:d,image_size:g,allowed_post_types:m,next:c,_wpnonce:p},success:function(n){if(n.success&&n.data.html){var o=s.find("li").length;if(s.append(n.data.html),n.data.has_more&&n.data.next_url?a.attr("data-next-url",n.data.next_url):a.hide(),s.zoomLoadAsyncImages(),s.hasClass("layout-masonry"))if("function"==typeof i.fn.masonry){var l=s.find("li").slice(o);s.data("masonry")||s.masonry({itemSelector:".zoom-instagram-widget__item",columnWidth:".masonry-items-sizer",percentPosition:!0,gutter:parseInt(s.data("spacing")||10)}),s.masonry("appended",l)}else console.log("Instagram Widget: Masonry library not available, using grid fallback"),setTimeout((function(){s.zoomInstagramWidget({onlyNewItems:!0,startIndex:o})}),100);else setTimeout((function(){s.zoomInstagramWidget({onlyNewItems:!0,startIndex:o})}),100);if("1"===s.attr("data-lightbox")&&n.data.lightbox_html){console.log("Instagram Widget: Adding new lightbox content after load more");var d=r.find(".wpz-insta-lightbox-wrapper .swiper-wrapper");if(d.length>0){d.append(n.data.lightbox_html),console.log("Instagram Widget: Added new lightbox slides");var g=d.parent();g.length>0&&g.get(0).swiper&&(console.log("Instagram Widget: Updating Swiper with new slides"),g.get(0).swiper.update()),d.find(".image-wrapper > .swiper").each((function(){this.swiper||(console.log("Instagram Widget: Initializing nested Swiper for album"),new Swiper(this,e(e(e(e(e(e(e(e(e(e({lazy:{threshold:50},watchSlidesVisibility:!0,preloadImages:!1},"lazy",!0),"direction","horizontal"),"loop",!1),"spaceBetween",20),"nested",!0),"watchOverflow",!0),"pagination",{el:i(this).find("> .swiper-pagination").get(0),type:"bullets",clickable:!0,hideOnClick:!1}),"navigation",{nextEl:i(this).find("> .swiper-button-next").get(0),prevEl:i(this).find("> .swiper-button-prev").get(0)}),"keyboard",{enabled:!0,onlyInViewport:!0}),"on",{activeIndexChange:function(){var t=this.slides[this.activeIndex],e=i(t).find("video").get(0);e&&e.play()}})))}));var m=s.find("li").slice(o).find(".zoom-instagram-link");m.length>0&&(console.log("Instagram Widget: Initializing lightbox for new items:",m.length),m.magnificPopup({items:{type:"inline",src:d.closest(".wpz-insta-lightbox-wrapper")},closeBtnInside:!1,mainClass:"wpzoom-lightbox",midClick:!0,callbacks:{open:function(){console.log("Instagram Widget: MagnificPopup opened for new item");var e=i.magnificPopup.instance.st.el,n=this.content.find("> .swiper").get(0).swiper;if(console.log("Instagram Widget: Current element data-mfp-src:",e.data("mfp-src")),this.content.find('> .swiper > .swiper-wrapper > .swiper-slide[data-uid="'+e.data("mfp-src")+'"] video')&&this.content.find('> .swiper > .swiper-wrapper > .swiper-slide[data-uid="'+e.data("mfp-src")+'"] video').trigger("play"),"object"===t(n)){var a=this.content.find('> .swiper > .swiper-wrapper > .swiper-slide[data-uid="'+e.data("mfp-src")+'"]').index();console.log("Instagram Widget: Sliding to index:",a),n.slideTo(a)}},afterClose:function(){g.find("video").each((function(){this.pause(),this.currentTime=0}))}}}),m.addClass("magnific-active"))}else console.log("Instagram Widget: Lightbox wrapper not found, initializing for entire container"),s.zoomLightbox()}r.trigger("wpz-insta:loaded-more",[n.data])}else console.error("Load more failed:",n.data||"Unknown error"),a.hide()},error:function(t,e,i){console.error("AJAX load more error:",i),a.hide()},complete:function(){a.removeClass("loading").prop("disabled",!1),o.removeClass("loading"),a.find(".button-text").text(f)}})}else a.hide()}}))}function o(){i(".zoom-instagram-widget__items").each((function(){var t=i(this);t.hasClass("layout-masonry")&&"function"==typeof i.fn.masonry?t.data("masonry")?t.masonry("layout"):t.masonry({itemSelector:".zoom-instagram-widget__item",columnWidth:".masonry-items-sizer",percentPosition:!0,gutter:parseInt(t.data("spacing")||10)}):t.zoomInstagramWidget()})),n=!1}a(),i.fn.zoomLoadAsyncImages=function(){return i(this).each((function(){var t=i(this),e=t.data("image-width"),n=t.data("image-resolution"),a=t.find("li").filter((function(){return i(this).data("media-id")})).map((function(){return{"media-id":i(this).attr("data-media-id"),nonce:i(this).attr("data-nonce"),"regenerate-thumbnails":i(this)[0].hasAttribute("data-regenerate-thumbnails")}}));a.length&&function(i,a){a=a||3;for(var o=0;o<i.length;o+=a)i.slice(o,o+a).forEach((function(i){wp.ajax.post("wpzoom_instagram_get_image_async",{"media-id":i["media-id"],nonce:i.nonce,"image-resolution":n,"image-width":e,"regenerate-thumbnails":i["regenerate-thumbnails"]}).done((function(e){t.find('li[data-media-id="'+i["media-id"]+'"] .zoom-instagram-link').css("background-image","url("+e.image_src+")")})).fail((function(){}))}))}(a.toArray(),3)}))},i.fn.zoomLightbox=function(){return i(this).each((function(){console.log("Instagram Widget: Initializing lightbox for element:",this);var n=i(this).closest(".widget").find(".wpz-insta-lightbox-wrapper > .swiper");console.log("Instagram Widget: Strategy 1 (.widget context):",n.length>0),0===n.length&&(n=i(this).closest(".zoom-instagram").find(".wpz-insta-lightbox-wrapper > .swiper"),console.log("Instagram Widget: Strategy 2 (.zoom-instagram context):",n.length>0)),0===n.length&&(n=i(this).parent().parent().find(".wpz-insta-lightbox-wrapper > .swiper"),console.log("Instagram Widget: Strategy 3 (parent context):",n.length>0)),console.log("Instagram Widget: Final swiper element:",n.length>0,n);var a=n.closest(".wpz-insta-lightbox-wrapper");if(console.log("Instagram Widget: Lightbox wrapper:",a.length>0),console.log("Instagram Widget: Lightbox wrapper content:",a.html()),n.length>0){var o=n.find(".image-wrapper > .swiper");new Swiper(n.get(0),e(e(e(e(e(e(e(e(e({lazy:{threshold:50},watchSlidesVisibility:!0,preloadImages:!1},"lazy",!0),"direction","horizontal"),"loop",!1),"spaceBetween",20),"autoHeight",!1),"watchOverflow",!0),"navigation",{nextEl:n.find("> .swiper-button-next").get(0),prevEl:n.find("> .swiper-button-prev").get(0)}),"keyboard",{enabled:!0,onlyInViewport:!0}),"on",{activeIndexChange:function(){var t=this.slides[this.activeIndex],e=i(t).find("video").get(0);e&&e.play()}})),o.each((function(){new Swiper(i(this).get(0),e(e(e(e(e(e(e(e(e(e({lazy:{threshold:50},watchSlidesVisibility:!0,preloadImages:!1},"lazy",!0),"direction","horizontal"),"loop",!1),"spaceBetween",20),"nested",!0),"watchOverflow",!0),"pagination",{el:i(this).find("> .swiper-pagination").get(0),type:"bullets",clickable:!0,hideOnClick:!1}),"navigation",{nextEl:i(this).find("> .swiper-button-next").get(0),prevEl:i(this).find("> .swiper-button-prev").get(0)}),"keyboard",{enabled:!0,onlyInViewport:!0}),"on",{activeIndexChange:function(){var t=this.slides[this.activeIndex],e=i(t).find("video").get(0);e&&e.play()}}))}));var r=i(this).closest(".widget").find(".zoom-instagram-widget__items");console.log("Instagram Widget: Gallery trigger strategy 1 (.widget):",r.length>0),0===r.length&&(r=i(this).closest(".zoom-instagram").find(".zoom-instagram-widget__items"),console.log("Instagram Widget: Gallery trigger strategy 2 (.zoom-instagram):",r.length>0)),0===r.length&&(r=i(this),console.log("Instagram Widget: Gallery trigger strategy 3 (this element):",r.length>0)),console.log("Instagram Widget: Final gallery trigger:",r.length>0,r),r.find(".zoom-instagram-link").magnificPopup({items:{type:"inline",src:n.closest(".wpz-insta-lightbox-wrapper")},closeBtnInside:!1,mainClass:"wpzoom-lightbox",midClick:!0,callbacks:{open:function(){console.log("Instagram Widget: MagnificPopup opened");var e=i.magnificPopup.instance.st.el,n=this.content.find("> .swiper").get(0).swiper;console.log("Instagram Widget: Current element:",e),console.log("Instagram Widget: Swiper instance:",n),this.content.find('> .swiper > .swiper-wrapper > .swiper-slide[data-uid="'+e.data("mfp-src")+'"] video')&&this.content.find('> .swiper > .swiper-wrapper > .swiper-slide[data-uid="'+e.data("mfp-src")+'"] video').trigger("play"),"object"===t(n)&&n.slideTo(this.content.find('> .swiper > .swiper-wrapper > .swiper-slide[data-uid="'+e.data("mfp-src")+'"]').index())},afterClose:function(){n.find("video").each((function(){this.pause(),this.currentTime=0}))}}}),r.find(".zoom-instagram-link").addClass("magnific-active")}}))},i.fn.zoomInstagramWidget=function(t){return i(this).each((function(){var e,n,a=i(this),o=t||{},r=a.data("images-per-row"),s=a.data("image-width"),l=a.data("image-spacing"),d=(a.data("image-lazy-loading"),a.width());d/s<r?(e=r,n=Math.floor((d-1-(r-1)*l)/r)):(e=Math.floor((d-1)/s),n=Math.floor((d-1-(e-1)*l)/e)),(o.onlyNewItems&&void 0!==o.startIndex?a.find("li").slice(o.startIndex):a.find("li")).each((function(t){var n=(o.onlyNewItems&&void 0!==o.startIndex?o.startIndex+t:t)+1;n%e==1?i(this).css("clear","left"):i(this).css("clear","none"),n%e==0?i(this).css("margin-right","0"):(i(this).css("margin-right",l+"px"),i(this).css("margin-bottom",l+"px"))})),a.find("a.zoom-instagram-link").css({width:n,height:n}),a.find("a.zoom-instagram-link-old").lazy(),a.find(".zoom-instagram-link-new").lazy(),a.removeClass("zoom-instagram-widget__items--no-js")}))},i(window).on("resize orientationchange",(function(){n||(n=!0,(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)})(o))})),i(".zoom-instagram-widget__items").each((function(){var t=i(this);t.hasClass("layout-masonry")&&"function"==typeof i.fn.masonry?t.masonry({itemSelector:".zoom-instagram-widget__item",columnWidth:".masonry-items-sizer",percentPosition:!0,gutter:parseInt(t.data("spacing")||10)}):t.zoomInstagramWidget()})),i(".zoom-instagram-widget__items").zoomLoadAsyncImages(),i('.zoom-instagram-widget__items[data-lightbox="1"]').zoomLightbox();var r=_.debounce((function(){var t=i(".zoom-instagram-widget__items");t.length&&(t.each((function(){var t=i(this);t.hasClass("layout-masonry")&&"function"==typeof i.fn.masonry?t.masonry({itemSelector:".zoom-instagram-widget__item",columnWidth:".masonry-items-sizer",percentPosition:!0,gutter:parseInt(t.data("spacing")||10)}):t.zoomInstagramWidget()})),i(".zoom-instagram-widget__items").zoomLoadAsyncImages())}),1500);i(document).on("panels_setup_preview",r),i(document).on("wpz-insta:loaded-more",(function(){a()})),i(window).on("elementor/frontend/init",(function(){elementorFrontend.hooks.addAction("frontend/element_ready/widget",(function(t){"wpzoom-elementor-instagram-widget.default"==t.data("widget_type")&&t.find(".zoom-instagram-widget__items").each((function(){var t=i(this);t.hasClass("layout-masonry")&&"function"==typeof i.fn.masonry?t.masonry({itemSelector:".zoom-instagram-widget__item",columnWidth:".masonry-items-sizer",percentPosition:!0,gutter:parseInt(t.data("spacing")||10)}):t.zoomInstagramWidget()}))}))}))}))})();